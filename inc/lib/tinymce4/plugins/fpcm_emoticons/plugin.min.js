tinymce.PluginManager.add("fpcm_emoticons", function (editor, t) {
    function getSmileyList() {
        var returnValue;
        
        jQuery.ajax({
            url: fpcmAjaxActionPath + 'editor/smileys',
            type: "POST",
            async: false,
            success: function(data) {
                returnValue = data;              
            }
        });
        return returnValue;
    }

    editor.addButton("emoticons", {
        type: "panelbutton",
        popoverAlign: "bc-tl",
        tooltip: "Emoticons",
        panel: {
            autohide: true,
            classes: 'fpcm-emoticons',
            html: getSmileyList,
            onclick: function(e) {
                var linkElm = editor.dom.getParent(e.target, 'img');
                if (linkElm) {
                    editor.insertContent(' ' + linkElm.getAttribute('smileycode') + ' ');
                    this.hide();
                }
            }
        }               
    });    
});